<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.110.0"><meta name=description content="An unofficial Microbit v2 API reference & guide book."><meta name=author content="c272"><link rel=icon href=/images/favicon.png type=image/png><title>Logging with MicroBitLog - micro:bit v2 Documentation</title><link href=/css/nucleus.css?1675177038 rel=stylesheet><link href=/css/fontawesome-all.min.css?1675177038 rel=stylesheet><link href=/css/hybrid.css?1675177038 rel=stylesheet><link href=/css/featherlight.min.css?1675177038 rel=stylesheet><link href=/css/perfect-scrollbar.min.css?1675177038 rel=stylesheet><link href=/css/auto-complete.css?1675177038 rel=stylesheet><link href=/css/atom-one-dark-reasonable.css?1675177038 rel=stylesheet><link href=/css/theme.css?1675177038 rel=stylesheet><link href=/css/tabs.css?1675177038 rel=stylesheet><link href=/css/hugo-theme.css?1675177038 rel=stylesheet><script src=/js/jquery-3.3.1.min.js?1675177038></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}:not(pre)>code+span.copy-to-clipboard{display:none}</style></head><body data-url=/guides/logging/><nav id=sidebar><div id=header-wrapper><div id=header><a id=logo href=/><img id=grav-logo src=/images/logo.png style=width:100%;height:100%></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/js/lunr.min.js?1675177038></script>
<script type=text/javascript src=/js/auto-complete.js?1675177038></script>
<script type=text/javascript>var baseurl="https://microbit.c272.org/"</script><script type=text/javascript src=/js/search.js?1675177038></script></div><section id=homelinks><ul><li><a class=padding href=/><i class='fas fa-home'></i> Home</a></li></ul></section><div class=highlightable><ul class=topics><li data-nav-id=/setup/ title=Setup class=dd-item><a href=/setup/><b>1. </b>Setup</a><ul><li data-nav-id=/setup/linux-install-guide/ title="Installing on Linux" class=dd-item><a href=/setup/linux-install-guide/>Installing on Linux</a></li><li data-nav-id=/setup/mac-install-guide/ title="Installing on MacOS" class=dd-item><a href=/setup/mac-install-guide/>Installing on MacOS</a></li><li data-nav-id=/setup/windows-install-guide/ title="Installing on Windows" class=dd-item><a href=/setup/windows-install-guide/>Installing on Windows</a></li><li data-nav-id=/setup/using-micro-tools/ title="Configuring & Using micro-tools" class=dd-item><a href=/setup/using-micro-tools/>Configuring & Using micro-tools</a></li><li data-nav-id=/setup/debug-setup-guide/ title="Setting up a Debug Environment" class=dd-item><a href=/setup/debug-setup-guide/>Setting up a Debug Environment</a></li></ul></li><li data-nav-id=/guides/ title=Guides class="dd-item
parent"><a href=/guides/><b>2. </b>Guides</a><ul><li data-nav-id=/guides/hello-world/ title="'Hello World' with micro:bit v2" class=dd-item><a href=/guides/hello-world/>'Hello World' with micro:bit v2</a></li><li data-nav-id=/guides/using-the-filesystem/ title="Using the micro:bit file system" class=dd-item><a href=/guides/using-the-filesystem/>Using the micro:bit file system</a></li><li data-nav-id=/guides/logging/ title="Logging with MicroBitLog" class="dd-item active"><a href=/guides/logging/>Logging with MicroBitLog</a></li><li data-nav-id=/guides/serial/ title="Interacting over serial I/O" class=dd-item><a href=/guides/serial/>Interacting over serial I/O</a></li></ul></li><li data-nav-id=/api-reference/ title="API Reference" class=dd-item><a href=/api-reference/><b>3. </b>API Reference</a><ul><li data-nav-id=/api-reference/core/ title=codal-core class=dd-item><a href=/api-reference/core/>codal-core</a><ul><li data-nav-id=/api-reference/core/accelerometer/ title=Accelerometer class=dd-item><a href=/api-reference/core/accelerometer/>Accelerometer</a></li><li data-nav-id=/api-reference/core/button/ title=Button class=dd-item><a href=/api-reference/core/button/>Button</a></li><li data-nav-id=/api-reference/core/compass/ title=Compass class=dd-item><a href=/api-reference/core/compass/>Compass</a></li><li data-nav-id=/api-reference/core/coordinatespace/ title=CoordinateSpace class=dd-item><a href=/api-reference/core/coordinatespace/>CoordinateSpace</a></li><li data-nav-id=/api-reference/core/keyvaluestorage/ title=KeyValueStorage class=dd-item><a href=/api-reference/core/keyvaluestorage/>KeyValueStorage</a></li><li data-nav-id=/api-reference/core/ledmatrix/ title=LEDMatrix class=dd-item><a href=/api-reference/core/ledmatrix/>LEDMatrix</a></li><li data-nav-id=/api-reference/core/managedbuffer/ title=ManagedBuffer class=dd-item><a href=/api-reference/core/managedbuffer/>ManagedBuffer</a></li><li data-nav-id=/api-reference/core/managedstring/ title=ManagedString class=dd-item><a href=/api-reference/core/managedstring/>ManagedString</a></li><li data-nav-id=/api-reference/core/messagebus/ title=MessageBus class=dd-item><a href=/api-reference/core/messagebus/>MessageBus</a></li><li data-nav-id=/api-reference/core/multibutton/ title=MultiButton class=dd-item><a href=/api-reference/core/multibutton/>MultiButton</a></li><li data-nav-id=/api-reference/core/nvmcontroller/ title=NVMController class=dd-item><a href=/api-reference/core/nvmcontroller/>NVMController</a></li><li data-nav-id=/api-reference/core/pin/ title=Pin class=dd-item><a href=/api-reference/core/pin/>Pin</a></li><li data-nav-id=/api-reference/core/sample3d/ title=Sample3D class=dd-item><a href=/api-reference/core/sample3d/>Sample3D</a></li><li data-nav-id=/api-reference/core/timer/ title=Timer class=dd-item><a href=/api-reference/core/timer/>Timer</a></li><li data-nav-id=/api-reference/core/touchbutton/ title=TouchButton class=dd-item><a href=/api-reference/core/touchbutton/>TouchButton</a></li><li data-nav-id=/api-reference/core/license/ title="License & Attribution" class=dd-item><a href=/api-reference/core/license/>License & Attribution</a></li></ul></li><li data-nav-id=/api-reference/microbit-v2/ title=codal-microbit-v2 class=dd-item><a href=/api-reference/microbit-v2/>codal-microbit-v2</a><ul><li data-nav-id=/api-reference/microbit-v2/microbit/ title=MicroBit class=dd-item><a href=/api-reference/microbit-v2/microbit/>MicroBit</a></li><li data-nav-id=/api-reference/microbit-v2/microbitaudio/ title=MicroBitAudio class=dd-item><a href=/api-reference/microbit-v2/microbitaudio/>MicroBitAudio</a></li><li data-nav-id=/api-reference/microbit-v2/microbitblemanager/ title=MicroBitBLEManager class=dd-item><a href=/api-reference/microbit-v2/microbitblemanager/>MicroBitBLEManager</a></li><li data-nav-id=/api-reference/microbit-v2/microbitcompasscalibrator/ title=MicroBitCompassCalibrator class=dd-item><a href=/api-reference/microbit-v2/microbitcompasscalibrator/>MicroBitCompassCalibrator</a></li><li data-nav-id=/api-reference/microbit-v2/microbitdisplay/ title=MicroBitDisplay class=dd-item><a href=/api-reference/microbit-v2/microbitdisplay/>MicroBitDisplay</a></li><li data-nav-id=/api-reference/microbit-v2/microbiti2c/ title=MicroBitI2C class=dd-item><a href=/api-reference/microbit-v2/microbiti2c/>MicroBitI2C</a></li><li data-nav-id=/api-reference/microbit-v2/microbitio/ title=MicroBitIO class=dd-item><a href=/api-reference/microbit-v2/microbitio/>MicroBitIO</a></li><li data-nav-id=/api-reference/microbit-v2/microbitlog/ title=MicroBitLog class=dd-item><a href=/api-reference/microbit-v2/microbitlog/>MicroBitLog</a></li><li data-nav-id=/api-reference/microbit-v2/microbitpowermanager/ title=MicroBitPowerManager class=dd-item><a href=/api-reference/microbit-v2/microbitpowermanager/>MicroBitPowerManager</a></li><li data-nav-id=/api-reference/microbit-v2/microbitradio/ title=MicroBitRadio class=dd-item><a href=/api-reference/microbit-v2/microbitradio/>MicroBitRadio</a></li><li data-nav-id=/api-reference/microbit-v2/microbitthermometer/ title=MicroBitThermometer class=dd-item><a href=/api-reference/microbit-v2/microbitthermometer/>MicroBitThermometer</a></li><li data-nav-id=/api-reference/microbit-v2/microbitusbflashmanager/ title=MicroBitUSBFlashManager class=dd-item><a href=/api-reference/microbit-v2/microbitusbflashmanager/>MicroBitUSBFlashManager</a></li><li data-nav-id=/api-reference/microbit-v2/license/ title="License & Attribution" class=dd-item><a href=/api-reference/microbit-v2/license/>License & Attribution</a></li></ul></li><li data-nav-id=/api-reference/nrf52/ title=codal-nrf52 class=dd-item><a href=/api-reference/nrf52/>codal-nrf52</a><ul><li data-nav-id=/api-reference/nrf52/nrf52adc/ title=NRF52ADC class=dd-item><a href=/api-reference/nrf52/nrf52adc/>NRF52ADC</a></li><li data-nav-id=/api-reference/nrf52/nrf52flashmanager/ title=NRF52FlashManager class=dd-item><a href=/api-reference/nrf52/nrf52flashmanager/>NRF52FlashManager</a></li><li data-nav-id=/api-reference/nrf52/nrf52pin/ title=NRF52Pin class=dd-item><a href=/api-reference/nrf52/nrf52pin/>NRF52Pin</a></li><li data-nav-id=/api-reference/nrf52/nrf52serial/ title=NRF52Serial class=dd-item><a href=/api-reference/nrf52/nrf52serial/>NRF52Serial</a></li><li data-nav-id=/api-reference/nrf52/nrf52touchsensor/ title=NRF52TouchSensor class=dd-item><a href=/api-reference/nrf52/nrf52touchsensor/>NRF52TouchSensor</a></li><li data-nav-id=/api-reference/nrf52/nrflowleveltimer/ title=NRFLowLevelTimer class=dd-item><a href=/api-reference/nrf52/nrflowleveltimer/>NRFLowLevelTimer</a></li><li data-nav-id=/api-reference/nrf52/license/ title="License & Attribution" class=dd-item><a href=/api-reference/nrf52/license/>License & Attribution</a></li></ul></li></ul></li></ul><section id=footer><p>Built with <a href=https://github.com/matcornic/hugo-theme-learn><i class="fas fa-heart"></i></a> by <a href=https://github.com/c272>C272</a>.<br></p><p style=color:#64586e;margin-top:.5em>This site is not affiliated, associated, authorized, or endorsed by the BBC or Lancaster University.</p></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=/>Home</a> > <a href=/guides/>Guides</a> > Logging with MicroBitLog</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#creating-the-logging-filesystem>Creating the Logging Filesystem</a></li><li><a href=#adding-log-entries>Adding Log Entries</a></li><li><a href=#accessing-log-data>Accessing Log Data</a></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Logging with MicroBitLog</h1><p>If your use case for the micro:bit v2 includes logging data from sensors and other event sources, then you may be tempted to use the <code>MicroBitFileSystem</code> or <code>KeyValueStorage</code> to store your log data for later retrieval from the micro:bit file system. However, new to micro:bit v2, there is an API designed specifically for logging: <code>MicroBitLog</code>. Use of this API allows you to store data in a table-like format, containing rows of field-value pairs, providing a handy web interface to view your results data by loading your micro:bit v2&rsquo;s file system from a PC.</p><div style=margin:auto;text-align:center;width:40%><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube.com/embed/4ZmZceFwyOU style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div><p style=margin-top:.5em;color:lightslategrey>A video from the BBC showing how you can access log data from the browser.</p></div><p>In this guide, we will set up a basic logging configuration for the micro:bit&rsquo;s temperature sensor, and allow this logging data to be accessed through a PC browser through observing the micro:bit v2&rsquo;s mounted file system.</p><h2 id=creating-the-logging-filesystem>Creating the Logging Filesystem</h2><p>To create the logging filesystem, you can simply get the instance of <code>MicroBitLog</code> from your global <code>MicroBit</code> instance, and perform a logging operation. Note that the logger class creates the filesystem on a lazy-load basis, so until you perform the first filesystem modifying operation, it will not be initialised on flash. You should only have one instance of <code>MicroBitLog</code> running at once, as it uses a class instance mutex to manage thread safety, so don&rsquo;t try and initialise and use an additional instance outside of <code>MicroBit</code>.</p><div class="notices info"><p>Take care when using this API in tandem with the <code>MicroBitFileSystem</code> or <code>KeyValueStorage</code>. The log file system is currently forced to be loaded from start address <code>0</code>, and takes up the subsequent 6144 bytes of space (2048 bytes for <code>MICROBIT_LOG_METADATA</code>, and 4096 bytes for <code>MICROBIT_LOG_JOURNAL</code>). Placing any other file systems within this range will result in undefined behaviour and (probably) horrific errors.</p></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;MicroBit.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;MicroBitLog.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>MicroBit uBit;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>()
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#75715e>//Initialise microbit API.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    uBit.init();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//Get the logger, do some logging stuff.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    uBit.log.setVisibility(true);
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=adding-log-entries>Adding Log Entries</h2><p>Once we have a reference to the logger, we can begin adding log entries from any input sources we might have. For this example, we will import data from the micro:bit&rsquo;s onboard temperature sensor every 10 seconds.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#75715e>//Only keep logging while we have space left.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>while</span> (<span style=color:#f92672>!</span>uBit.log.isFull()) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//Create a row with temperature data.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    uBit.log.beginRow();
</span></span><span style=display:flex><span>    uBit.log.logData(<span style=color:#e6db74>&#34;temperature&#34;</span>, uBit.thermometer.getTemperature());
</span></span><span style=display:flex><span>    uBit.log.endRow();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//Wait a while.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    uBit.sleep(<span style=color:#ae81ff>10</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>1000</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>With this sort of data, it&rsquo;s probably useful to have a timestamp attached to it. To achieve this, we can modify our logging code to use a handy method provided by the logger which sets a timestamp to be attached to each log row. When enabling timestamping, we also need to choose the granularity of the attached timestamps. The available time stamp granularities are:</p><ul><li>None (no timestamp attached)</li><li>Milliseconds</li><li>Seconds</li><li>Minutes</li><li>Hours</li><li>Days</li></ul><p>We can modify our code to enable timestamps before we start logging data like so:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#75715e>//Set log entry timestamp type to log the seconds passed.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>uBit.log.setTimeStamp(TimeStampFormat<span style=color:#f92672>::</span>Seconds);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>//Only keep logging while we have space left.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>while</span> (<span style=color:#f92672>!</span>uBit.log.isFull()) {
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=accessing-log-data>Accessing Log Data</h2><p>Now that we&rsquo;ve logged data to the micro:bit&rsquo;s flash, what is remaining is to access this from the PC side. First, we should make sure that the HTML file that allows you to access your data is set to be visible from the micro:bit code. To make the HTML viewer visible from the mounted partition, you can run the following from your micro:bit code.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>uBit.log.setVisibility(true);
</span></span></code></pre></div><p>Once this is done, you should be able to open <code>MY_DATA.html</code> from the mounted partition on your PC, and view the logged data through the browser.</p><img style=margin-bottom:.5em src=/images/microbitlog-mydata.webp><div style=margin:auto;text-align:center;width:><p style=margin-top:.5em;color:lightslategrey>Image Attribution: (c) British Broadcasting Corporation, 2022</p></div><p>You can also access the log data from code, by using the <code>readData()</code> method in tandem with the <code>getDataLength()</code> method. This allows you to read from either the HTML header, HTML header with data, or the raw CSV data alone, with a given offset and length. An example would be something like the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#75715e>//Get the length of the CSV data to read out, make a buffer for it.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>uint32_t</span> csvLen <span style=color:#f92672>=</span> uBit.log.getDataLength(DataFormat<span style=color:#f92672>::</span>CSV);
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span><span style=color:#f92672>*</span> csvData <span style=color:#f92672>=</span> malloc(csvLen);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>//Read this data from the logger with offset 0.
</span></span></span><span style=display:flex><span><span style=color:#75715e>//The last parameter of this call should always be the result of getDataLength(DataFormat::...),
</span></span></span><span style=display:flex><span><span style=color:#75715e>//equivalent to the type of data you&#39;re receiving.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>int</span> result <span style=color:#f92672>=</span> uBit.log.readData(csvData, <span style=color:#ae81ff>0</span>, csvLen, DataFormat<span style=color:#f92672>::</span>CSV, csvLen);
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (result <span style=color:#f92672>!=</span> DEVICE_OK) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>//Something bad happened!
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>//...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><footer class=footline></footer></div></div><div id=navigation></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js?1675177038></script>
<script src=/js/perfect-scrollbar.min.js?1675177038></script>
<script src=/js/perfect-scrollbar.jquery.min.js?1675177038></script>
<script src=/js/jquery.sticky.js?1675177038></script>
<script src=/js/featherlight.min.js?1675177038></script>
<script src=/js/highlight.pack.js?1675177038></script>
<script>hljs.initHighlightingOnLoad()</script><script src=/js/modernizr.custom-3.6.0.js?1675177038></script>
<script src=/js/learn.js?1675177038></script>
<script src=/js/hugo-learn.js?1675177038></script>
<script src=/mermaid/mermaid.js?1675177038></script>
<script>mermaid.initialize({startOnLoad:!0})</script></body></html>